<!DOCTYPE html>
<meta charset="utf-8">
<body>
<script src="js/d3.v3.js"></script>
<script src="js/d3.geo.tile.v0.min.js"></script>
<script src="js/graphlib.js"></script>
<script>

// unnamed
test = function test(context) {
  var that = this;

  var inner = function inner() {
    console.log('inner this:');  // this = test (when called: test.inner() )
    console.log(this);
    console.log('inner that:'); // that = window
    console.log(that);
    console.log('------------');
    var inner2 = function inner2() {
      console.log('inner2 this:'); // this = inner2 (when called: test.inner().inner2() )
      console.log(this);
      console.log('inner2 that:'); // that = window
      console.log(that);
      console.log('------------');
      inner3 = (function inner3() {
        console.log('inner3 this:'); // this = window (when autorun with: test.inner().inner2() or test.inner().inner2().inner3 )
        console.log(this);
        console.log('inner3 that:'); // that = window (when autorun with: test.inner().inner2() or test.inner().inner2().inner3 )
        console.log(that);
        console.log('------------');
        function inner4() {
          console.log('inner4 this:'); // this = inner4 (when autorun with: test.inner().inner2().inner3.test4() )
          console.log(this);
          console.log('inner4 that:'); // that = window (when autorun with: test.inner().inner2().inner3.test4() )
          console.log(that);
          debugger;
          console.log('test().inner().var: '+test.inner().var); // succeeds
          console.log(  'test.inner().var: '+test.inner().var); // fails, but test.inner().var from the console succeeds
                                                                //  probably because this runs before test has finished creating a global object
                                                                //  that can be referenced
        }
        return {
          inner4: inner4
        };
      }());
      return {
        inner3: inner3
      };
    };
    return {
      inner2: inner2,
      var: 'yup'
    };
  };
  // API
  return {
    inner: inner
  };



}(this);


</script>

</body>
</html>
